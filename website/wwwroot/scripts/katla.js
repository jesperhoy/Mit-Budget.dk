/*!Katla v. 1.0.2 - Copyright 2024 Jesper Hoy*/
"use strict";(()=>{var X=Object.defineProperty;var Y=(t,e,n)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>(Y(t,typeof e!="symbol"?e+"":e,n),n),D=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var c=(t,e,n)=>(D(t,e,"read from private field"),n?n.call(t):e.get(t)),O=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},B=(t,e,n,o)=>(D(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);var N=(t,e,n)=>(D(t,e,"access private method"),n);var v=class{constructor(e){h(this,"html");this.html=e}};function $(t,e,n){let o=document.createElement("template");return o.innerHTML=t.html,e.node2.parentNode.insertBefore(o.content,e.node2),{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>a.html===t.html}}var u=class extends Error{constructor(n,o,a){super(n,{cause:a});h(this,"ctx");this.ctx=o,this.name="KatlaError"}};var x=new Map;x.set("validity",(t,e,n,o)=>{let a=t;function i(p){if(typeof p!="string")throw new u("#validity value must be string");a.setCustomValidity(""),a.checkValidity()&&p!==""&&a.setCustomValidity(p)}return i(e),p=>{e=p,i(p)}});x.set("ref",(t,e,n,o)=>{if(typeof e!="function")throw new u("#ref value must be function");return e(t),()=>{}});x.set("bind",(t,e,n,o)=>{let a=t.tagName.toLowerCase();a==="input"&&(a=t.type,a||(a="text"),a=a.toLowerCase());let i,p,r,l=n.indexOf("trim")>=0;function s(){let m=t.value;return(a==="number"||a==="range"||n.indexOf("number")>=0)&&(m=parseInt(m)),l&&(m=m.trim()),m}function f(){if(p=void 0,Array.isArray(e)&&e.length===2)if(Array.isArray(e[0])&&typeof e[1]=="number")i=e[0][e[1]],p=m=>e[0][e[1]]=m;else if(typeof e[0]=="object"&&typeof e[1]=="string"){if(!e[0].hasOwnProperty(e[1]))throw new u(a+" #bind to object does not have property '"+e[1]+"'");i=e[0][e[1]],p=m=>e[0][e[1]]=m}else typeof e[0]=="function"&&typeof e[1]=="function"?(i=e[0](),p=e[1]):typeof e[1]=="function"&&(i=e[0],p=e[1]);else if(Array.isArray(e)&&e.length===1&&Array.isArray(e[0])){if(a!=="checkbox")throw new u("Can only #bind to [Array] with input/checkbox");i=e[0],p=()=>{}}if(!p)throw new u("Can only #bind to {object}.PropName / [Object,string] / [Array,number] / [getFunc,setFunc]");if(a==="radio"){if(!t.hasAttribute("value"))throw new u("input/radio element missing 'value' attribute - for #bind");let m=s(),d=i===m;if(d===r)return;t.checked=d,r=d}else if(a==="checkbox")if(typeof i=="boolean"){if(i===r)return;t.checked=i,r=i;return}else{if(!Array.isArray(i))throw new u("#bind value for input/checkbox must be either boolean or array");if(!t.hasAttribute("value"))throw new u("input/checkbox element missing 'value' attribute - for #bind with array value");let m=s(),d=i.indexOf(m)>=0;if(d===r)return;t.checked=d,r=d}else{if(i===r)return;t.value=Number.isNaN(i)?"":i.toString(),r=i}}f();function b(m){let d=s();if(a==="radio"){if(!t.checked)return;p(d),r=d}else if(a==="checkbox"){let C=t.checked;if(typeof i=="boolean")p(C);else{let S=i.indexOf(d);C&&S<0&&i.push(d),!C&&S>=0&&i.splice(S,1)}r=C}else p(d),r=d,l&&m.type==="change"&&t.value!==r&&(t.value=r);o.autoRedraw?n.indexOf("noredraw")<0&&o.redraw():n.indexOf("redraw")>=0&&o.redraw()}let w=n.indexOf("eager")>=0;return w&&t.addEventListener("input",b),(!w||l)&&t.addEventListener("change",b),m=>{e=m,f()}});function k(t,e,n,o,a){let i=a,p;if(e.charAt(0)==="@"){if(typeof a!="function")throw new u(e+" handler must be function",o);let r=e.substr(1).split("|"),l={capture:r.indexOf("capture")>0,once:r.indexOf("once")>0,passive:r.indexOf("passive")>0};t.addEventListener(r[0],s=>{if(r.indexOf("self")>0&&s.target!==t)return;r.indexOf("prevent")>0&&s.preventDefault(),r.indexOf("stop")>0&&s.stopPropagation();let f=i(s);(o.app.autoRedraw?!r.includes("noredraw"):r.includes("redraw"))&&(o.app.redraw(),f instanceof Promise&&f.then(()=>o.app.redraw()))},l)}else if(e.charAt(0)===".")t[e.substr(1)]=a;else if(e.charAt(0)==="#"){let r=e.substr(1).split("|"),l=x.get(r[0]);if(l===void 0)throw new u("Unknown directive '#"+r[0]+"'",o);p=l(t,a,r.slice(1),o.app)}else a===!1||a===null||a===void 0||(a===!0?t.setAttribute(e,""):t.setAttribute(e,a.toString()));return{GetData:n,Update:r=>{if(!(r===i&&typeof r!="object"))if(i=r,e.charAt(0)==="@"){if(typeof r!="function")throw new u(e+" handler must be function",o)}else e.charAt(0)==="."?t[e.substr(1)]=r:e.charAt(0)==="#"?p(r):r===!1||r===null||r===void 0?t.removeAttribute(e):r===!0?t.setAttribute(e,""):t.setAttribute(e,r.toString())},Unload:()=>{}}}function K(t,e,n){let o=t.bldr.MakeLive(t.args,e.node2,n);return{Update:a=>o.Update(a.args),Unload:o.Unload,MatchForUpdate:a=>a.bldr===t.bldr}}var U=class{constructor(e,n){h(this,"bldr");h(this,"args");this.bldr=e,this.args=n}};function W(t,e,n){let o=document.createTextNode(t.toString());return e.node2.parentNode.insertBefore(o,e.node2),{Update:a=>{a!==t&&(t=a,o.data=a.toString())},Unload:()=>{},MatchForUpdate:a=>!0}}var M=class{constructor(e,n,o){h(this,"app");h(this,"component");h(this,"parent");h(this,"values",new Map);this.app=e,this.parent=n,this.component=o}setValue(e,n){this.values.set(e,n)}getValue(e){let n=this.values.get(e);if(n!==void 0)return n;if(this.parent!==void 0)return this.parent.getValue(e)}};function G(t,e,n){let o=new t[0];o.$app=n.app,o.$parent=n.component;let a=new M(n.app,n,o);if(o.$get=s=>a.getValue(s),o.$set=(s,f)=>a.setValue(s,f),o.$redraw=l,t.length>1&&Object.assign(o,t[1]),o.load&&o.load(),!o.render)throw new u("Component object must have .render property",n);if(typeof o.render!="function")throw new u("Component .render property must be a function",n);t.length>2&&t[2](o);let i=o.render(),p=A(i,n),r=E(i,e,a);function l(){t.length>1&&Object.assign(o,t[1]),i=o.render();let s=A(i,n);s!==5&&(p===s&&r.MatchForUpdate(i)?r.Update(i):(r.Unload(),e.ClearContent(),p=s,r=E(i,e,a)))}return{Update:s=>{o&&(t=s,l())},Unload:()=>{o.unload&&o.unload(),r.Unload(),o=void 0},MatchForUpdate:s=>s[0]===t[0]}}function _(t,e,n){let o=[];a(t);function a(i){if(i.length===0)return;let p=document.createDocumentFragment(),r=document.createComment("");p.append(r);let l,s;for(let f of i)s=document.createComment(""),p.append(s),l=T(r,-1,n,f),o.push(l),r=s;e.node2.parentNode.insertBefore(p,e.node2)}return{Update:i=>{if(o.length===0){a(i);return}if(i.length===0){e.ClearContent(),o=[];return}let p,r;for(let l=0;l<i.length||l<o.length;l++)if(l<i.length&&l<o.length)o[l].Update(i[l]);else if(i.length<o.length)p=o[l],p.Unload(),p.ClearContent(),p.node1.parentNode.removeChild(p.node1),o[l-1].node2=p.node2,o.splice(l,1),l-=1;else{let s=document.createComment("");p=o[o.length-1],p.node2.parentNode.insertBefore(s,p.node2),r=T(s,-1,n,i[l]),p.node2=s,o.push(r)}},Unload:()=>{o.forEach(i=>i.Unload()),o=[]},MatchForUpdate:i=>!0}}function A(t,e){if(t===null||t===""||t===!1)return 0;if(t instanceof U)return 4;if(Array.isArray(t)){if(t.length>0&&typeof t[0]=="function"){if(t.length>1){if(typeof t[1]!="object")throw new u("Component props must be object",e);if(["render","load","unload","context"].forEach(n=>{if(t[1].hasOwnProperty(n))throw new u("Invalid component props property name: '"+n+"'",e)}),t.length>2&&typeof t[2]!="function")throw new u("Component ref must be function",e)}return 2}return 6}if(t instanceof v)return 3;if(t instanceof R)return 5;if(typeof t=="string"||typeof t=="number"||typeof t=="object")return 1;throw new u("Unknown content var type: "+typeof t,e)}function E(t,e,n){switch(A(t,n)){case 0:return{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>!0};case 1:return W(t,e,n);case 2:return G(t,e,n);case 3:return $(t,e,n);case 4:return K(t,e,n);case 6:return _(t,e,n);case 5:throw new u("NoChange at creation",n)}}var R=class{};function T(t,e,n,o){let a=A(o,n),i,p={GetData:r=>r[e],node1:t,node2:t.nextSibling,Update:r=>{let l=A(r,n);l!==5&&(a===l&&i.MatchForUpdate(r)?i.Update(r):(i.Unload(),p.ClearContent(),a=l,i=E(r,p,n)))},ClearContent:()=>{let r=p.node1.nextSibling;for(;r!==p.node2;)p.node1.parentNode.removeChild(r),r=p.node1.nextSibling},Unload:()=>()=>i.Unload()};return i=E(o,p,n),p}var y,H,F,q,L,I,j=class{constructor(e){O(this,F);O(this,L);O(this,y,[]);O(this,H,document.createElement("template"));let n="";for(let o=0;o<e.length-1;o++)n+=e[o],n+=N(this,F,q).call(this,n)?"{{fv"+o+"}}":"<!--{{fv"+o+"}}-->";n+=e[e.length-1],c(this,H).innerHTML=n,N(this,L,I).call(this,c(this,H).content,[])}MakeLive(e,n,o){let a=c(this,H).content.cloneNode(!0),i=c(this,y).map(p=>{let r=a;return p.path.forEach(l=>r=r.childNodes[l]),{ph:p,n:r}}).map(p=>p.ph.CreateOp(p.n,o,e)).filter(p=>p!==null);return n.parentNode.insertBefore(a,n),{Update:p=>{for(let r of i)r.Update(r.GetData(p))},Unload:()=>{for(let p of i)p.Unload()}}}};y=new WeakMap,H=new WeakMap,F=new WeakSet,q=function(e){return e.lastIndexOf("<")>e.lastIndexOf(">")},L=new WeakSet,I=function(e,n){let o,a,i,p,r,l;for(let s=0;s<e.childNodes.length;s++)if(o=e.childNodes[s],l=n.concat(s),o.nodeType===1){let f=o;f.tagName.toLowerCase()==="select"&&N(this,L,I).call(this,o,l);let b=[],w=[],m=!1;for(let d=0;d<f.attributes.length;d++){if(r=f.attributes[d],r.name==="class"){if(b.length>0)throw new u("Cannot combine 'class' and 'class:...' attributes on same element");m=!0}if(a=r.value,i=a.indexOf("{{fv"),i<0){if(r.name.startsWith("class:"))throw new u(r.name+" attribute must have ${boolean} value");(r.name.charAt(0)==="#"||r.name.charAt(0)===".")&&((r.name.charAt(0)==="#"?w:c(this,y)).push(ee(l,r.name,a)),f.removeAttribute(r.name),d-=1);continue}let C=[];for(;i>=0;){if(i>0&&C.push(a.substr(0,i)),a=a.substr(i+4),i=a.indexOf("}}"),i<0)throw new u("Unexpected missing }}");p=parseInt(a.substr(0,i)),C.push(p),a=a.substr(i+2),i=a.indexOf("{{fv")}if(a.length>0&&C.push(a),C.length===1)if(r.name.startsWith("class:")){if(m)throw new u("Cannot combine 'class' and 'class:...' attributes on same element");b.push({class:r.name.substr(6),argidx:C[0]})}else(r.name.charAt(0)==="#"?w:c(this,y)).push(te(l,r.name,C[0]));else{if(r.name.startsWith("class:"))throw new u(r.name+" attribute must have ${boolean} value");(r.name.charAt(0)==="#"?w:c(this,y)).push(ne(l,r.name,C))}f.removeAttribute(r.name),d-=1}b.length>0&&c(this,y).push(re(l,b)),c(this,y).push(...w),f.tagName.toLowerCase()!=="select"&&N(this,L,I).call(this,o,l)}else if(o.nodeType===8){let f=o;f.data.substr(0,4)==="{{fv"&&(p=parseInt(f.data.substr(4,f.data.length-6)),f.data="",e.insertBefore(document.createComment(""),o),c(this,y).push(oe(l,p)),s+=1)}};function ee(t,e,n){return{path:t,CreateOp(o,a,i){let p=r=>n;return k(o,e,p,a,p(i)),null}}}function te(t,e,n){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(o,a,i){let p=r=>r[n];return k(o,e,p,a,p(i))}}}function ne(t,e,n){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(o,a,i){let p;return(e==="#bind"||e.substr(0,6)==="#bind|")&&n.length===2&&typeof n[1]=="string"&&n[1].charAt(0)==="."?p=r=>[r[n[0]],n[1].substr(1)]:p=r=>n.map(l=>typeof l=="string"?l:r[l].toString()).join(""),k(o,e,p,a,p(i))}}}function re(t,e){return{path:t,CreateOp(n,o,a){let i=p=>{let r="",l;for(let s=0;s<e.length;s++){if(l=p[e[s].argidx],typeof l!="boolean")throw new u("class:"+e[s].class+" value must be boolean");l&&(r+=(r.length>0?" ":"")+e[s].class)}return r.length===0?!1:r};return k(n,"class",i,o,i(a))}}}function oe(t,e){return{path:t,CreateOp(n,o,a){return T(n,e,o,a[e])}}}var z=new Map;function P(t,...e){let n=z.get(t);return n||(n=new j(t),z.set(t,n)),new U(n,e)}function J(t,e){typeof t=="string"&&(t=document.querySelector(t));let n,o={autoRedraw:!0,redraw(){n.Update(e())},clear(){n.ClearContent()}},a=document.createDocumentFragment(),i=document.createComment("Katla");a.appendChild(i);let p=document.createComment("/Katla");return a.appendChild(p),n=T(i,-1,new M(o),e()),t.appendChild(a),o}var g,V=class{constructor(){h(this,"deps");h(this,"render2");O(this,g,void 0)}render(){if(c(this,g)&&c(this,g).length===this.deps.length){let e=!0;for(let n=0;n<c(this,g).length;n++)if(c(this,g)[n]!==this.deps[n]){e=!1;break}if(e)return this.deps=void 0,new R}return B(this,g,Object.assign({},this.deps)),this.deps=void 0,this.render2()}};g=new WeakMap;function Q(t,e){if(!t||!Array.isArray(t))throw new u("memo deps argument must be array");if(!e||typeof e!="function")throw new u("memo render argument must be function");return[V,{deps:t,render2:e}]}var ae=t=>new v(t),ie=(t,e)=>x.set(t,e);globalThis.Katla={html:P,app:J,raw:ae,directive:ie,memo:Q};globalThis.html=P;})();
//# sourceMappingURL=katla.js.map
