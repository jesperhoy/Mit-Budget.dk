/*!Katla v. 3.4.1 - Copyright 2025 Jesper Hoy*/
"use strict";(()=>{var ne=Object.defineProperty;var oe=(t,e,r)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var j=(t,e,r)=>(oe(t,typeof e!="symbol"?e+"":e,r),r),V=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var f=(t,e,r)=>(V(t,e,"read from private field"),r?r.call(t):e.get(t)),h=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},w=(t,e,r,n)=>(V(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var R=(t,e,r)=>(V(t,e,"access private method"),r);var M=class{html;constructor(e){this.html=e}};function _(t,e){let r=document.createElement("template");return r.innerHTML=t.html,e(r.content),{Update:n=>{},Unload:()=>{},MatchForUpdate:n=>n.html===t.html}}var v=new Map;v.set("validity",(t,e,r,n)=>{let a=t;function i(s){if(typeof s!="string")throw new Error("Katla: #validity value must be string");a.setCustomValidity(s)}return i(e),i});v.set("ref",(t,e,r,n)=>{if(typeof e!="function")throw new Error("Katla: #ref value must be function");return e(t),()=>{}});v.set("bind",(t,e,r,n)=>{let a=t.tagName.toLowerCase();a==="input"&&(a=t.type,a||(a="text"),a=a.toLowerCase());let i,s,o,l=r.indexOf("notrim")<0&&(t.tagName=="TEXTAREA"||t.tagName=="INPUT"&&["text","email","search","url"].includes(t.type));function p(){let c=t.value;return(a==="number"||a==="range"||r.indexOf("number")>=0)&&(c=parseInt(c)),l&&(c=c.trim()),c}function u(){if(s=void 0,Array.isArray(e)&&e.length===2)if(Array.isArray(e[0])&&typeof e[1]=="number")i=e[0][e[1]],s=c=>e[0][e[1]]=c;else if(typeof e[0]=="object"&&typeof e[1]=="string"){if(!e[0].hasOwnProperty(e[1]))throw new Error("Katla: "+a+" #bind to object does not have property '"+e[1]+"'");i=e[0][e[1]],s=c=>e[0][e[1]]=c}else typeof e[0]=="function"&&typeof e[1]=="function"?(i=e[0](),s=e[1]):typeof e[1]=="function"&&(i=e[0],s=e[1]);else if(Array.isArray(e)&&e.length===1&&Array.isArray(e[0])){if(a!=="checkbox")throw new Error("Katla: Can only #bind to [Array] with input/checkbox");i=e[0],s=()=>{}}if(!s)throw new Error("Katla: Can only #bind to {object}.PropName / [Object,string] / [Array,number] / [value,setFunc] / [Array]");if(a==="radio"){if(!t.hasAttribute("value"))throw new Error("Katla: input/radio element missing 'value' attribute - for #bind");let c=p(),m=i===c;if(m===o)return;t.checked=m,o=m}else if(a==="checkbox")if(typeof i=="boolean"){if(i===o)return;t.checked=i,o=i;return}else{if(!Array.isArray(i))throw new Error("Katla: #bind value for input/checkbox must be either boolean or array");if(!t.hasAttribute("value"))throw new Error("Katla: input/checkbox element missing 'value' attribute - for #bind with array value");let c=p(),m=i.indexOf(c)>=0;if(m===o)return;t.checked=m,o=m}else if(a==="file")(!i||!i.files||i.files.length===0)&&(t.value="");else{if(i===o)return;t.value=Number.isNaN(i)?"":i.toString(),o=i}}u();function C(c){let m=p();if(a==="radio"){if(!t.checked)return;s(m),o=m}else if(a==="checkbox"){let d=t.checked;if(typeof i=="boolean")s(d);else{let D=i.indexOf(m);d&&D<0&&i.push(m),!d&&D>=0&&i.splice(D,1)}o=d}else a==="file"?(t.id||(t.id="file-"+Math.floor(Math.random()*Date.now()).toString(36)),s({id:t.id,files:Array.from(t.files).map(d=>({name:d.name,size:d.size,type:d.type,lastModified:d.lastModified}))})):(s(m),o=m,l&&c.type==="change"&&t.value!==o&&(t.value=o));r.indexOf("noredraw")<0&&n()}let b=r.indexOf("eager")>=0;return b&&t.addEventListener("input",C),(!b||l)&&t.addEventListener("change",C),c=>{e=c,u()}});function k(t,e,r,n,a){let i=a,s;if(e.charAt(0)==="@"){if(typeof a!="function")throw new Error("Katla: '"+e+"' handler must be function");let o=e.substr(1).split("|");t.addEventListener(o[0],l=>{if(o.indexOf("self")>0&&l.target!==t)return;o.indexOf("default")<1&&l.preventDefault(),o.indexOf("stop")>0&&l.stopPropagation();let p=i(l);o.includes("noredraw")||(p instanceof Promise?p.then(()=>n.$redraw()):n.$redraw())},{capture:o.indexOf("capture")>0,once:o.indexOf("once")>0,passive:o.indexOf("passive")>0})}else if(e.charAt(0)===".")t[e.substr(1)]=a;else if(e.charAt(0)==="#"){let o=e.substr(1).split("|"),l=v.get(o[0]);if(l===void 0)throw new Error("Katla: Unknown directive '#"+o[0]+"'");s=l(t,a,o.slice(1),()=>n.$redraw())}else a===!1||a===null||a===void 0||(a===!0?t.setAttribute(e,""):t.setAttribute(e,a.toString()));return{GetData:r,Update:o=>{if(!(o===i&&typeof o!="object"))if(i=o,e.charAt(0)==="@"){if(typeof o!="function")throw new Error("Katla: "+e+" handler must be function")}else e.charAt(0)==="."?t[e.substr(1)]=o:e.charAt(0)==="#"?s(o):o===!1||o===null||o===void 0?t.removeAttribute(e):o===!0?t.setAttribute(e,""):t.setAttribute(e,o.toString())},Unload:()=>{}}}function X(t,e,r){let n=t.bldr.MakeLive(t.args,r);return e(n.ContentNode),{Update:a=>n.Update(a.args),Unload:n.Unload,MatchForUpdate:a=>a.bldr===t.bldr}}var x=class{bldr;args;constructor(e,r){this.bldr=e,this.args=r}};function J(t,e){let r=document.createTextNode(t.toString());return e(r),{Update:n=>{n!==t&&(t=n,r.data=n.toString())},Unload:()=>{},MatchForUpdate:n=>!0}}function W(t,e=null){let r;t.$get=n=>{if(r&&r.has(n))return r.get(n);if(e)return e.$get(n)},t.$set=(n,a)=>{r||(r=new Map),r.set(n,a)}}function Q(t,e,r){let n=new t[0];if(n.$parent=r,n.$redraw=()=>r.$redraw(),n.$app={redraw:()=>r.$redraw()},W(n,r),t.length>1&&Object.assign(n,t[1]),t.length>2&&t[2](n),n.load&&n.load(),!n.render||typeof n.render!="function")throw new Error("Katla: Component must have .render method");let a=n.render(),i=A(a),s=H(a,e,n),o=!1;return{Update:l=>{if(o)return;t=l,t.length>1&&Object.assign(n,t[1]),a=n.render();let p=A(a);p!==5&&(i===p&&s.MatchForUpdate(a)?s.Update(a):(s.Unload(),i=p,s=H(a,e,n)))},Unload:()=>{o||(n.unload&&n.unload(),s.Unload(),o=!0)},MatchForUpdate:l=>t[0]===l[0]}}function Y(t,e,r){let n=[],a=[];function i(p){let u=n.length,C=document.createComment(""),b=a[u];a.splice(u,0,C),b.parentNode.insertBefore(C,b),n.push(T(c=>{let m=document.createRange();m.setStartAfter(a[u]),m.setEndBefore(a[u+1]),m.deleteContents(),c&&m.insertNode(c)},-1,r,p))}function s(p){let u=document.createRange();u.setStartAfter(a[p]),u.setEndAfter(a[p+1]),u.deleteContents(),a.splice(p+1,1),n[p].Unload(),n.splice(p,1)}let o=new DocumentFragment,l=document.createComment("");a.push(l),o.append(l);for(let p of t)i(p);return e(o),{Update:p=>{for(let u=0;u<p.length||u<n.length;u++)u<p.length&&u<n.length?n[u].Update(p[u]):p.length<n.length?(s(u),u-=1):i(p[u])},Unload:()=>{n.forEach(p=>p.Unload()),n=[]},MatchForUpdate:p=>!0}}function A(t){if(t===null||t===""||t===!1)return 0;if(t instanceof x)return 4;if(Array.isArray(t))return t.length>0&&typeof t[0]=="function"?2:6;if(t instanceof M)return 3;if(t instanceof F)return 5;if(typeof t=="string"||typeof t=="number"||typeof t=="object")return 1;throw new Error("Katla: Unknown content type: "+typeof t)}function H(t,e,r){switch(A(t)){case 0:return e(null),{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>!0};case 1:return J(t,e);case 2:return Q(t,e,r);case 3:return _(t,e);case 4:return X(t,e,r);case 6:return Y(t,e,r);case 5:throw new Error("Katla: NoChange at creation")}}var F=class{};function T(t,e,r,n){let a=A(n),i,s={GetData:o=>o[e],Update:o=>{let l=A(o);l!==5&&(a===l&&i.MatchForUpdate(o)?i.Update(o):(i.Unload(),a=l,i=H(o,t,r)))},Unload:()=>()=>i.Unload()};return i=H(n,t,r),s}var y,U,S,ee,L,K,$=class{constructor(e){h(this,S);h(this,L);h(this,y,[]);h(this,U,document.createElement("template"));let r="";for(let n=0;n<e.length-1;n++)r+=e[n],r+=R(this,S,ee).call(this,r)?"{{fv"+n+"}}":"<!--{{fv"+n+"}}-->";r+=e[e.length-1],f(this,U).innerHTML=r,R(this,L,K).call(this,f(this,U).content,[])}MakeLive(e,r){let n=f(this,U).content.cloneNode(!0),a=f(this,y).map(i=>{let s=n;return i.path.forEach(o=>s=s.childNodes[o]),{ph:i,n:s}}).map(i=>i.ph.CreateOp(i.n,r,e)).filter(i=>i!==null);return{ContentNode:n,Update:i=>{for(let s of a)s.Update(s.GetData(i))},Unload:()=>{for(let i of a)i.Unload()}}}};y=new WeakMap,U=new WeakMap,S=new WeakSet,ee=function(e){return e.lastIndexOf("<")>e.lastIndexOf(">")},L=new WeakSet,K=function(e,r){let n,a,i,s,o,l;for(let p=0;p<e.childNodes.length;p++)if(n=e.childNodes[p],l=r.concat(p),n.nodeType===1){let u=n;u.tagName.toLowerCase()==="select"&&R(this,L,K).call(this,n,l);let C=[],b=[],c=!1;for(let m=0;m<u.attributes.length;m++){if(o=u.attributes[m],o.name==="class"){if(C.length>0)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");c=!0}if(a=o.value,i=a.indexOf("{{fv"),i<0){if(o.name.startsWith("class:"))throw new Error("Katla: "+o.name+" attribute must have ${boolean} value");(o.name.charAt(0)==="#"||o.name.charAt(0)===".")&&((o.name.charAt(0)==="#"?b:f(this,y)).push(ie(l,o.name,a)),u.removeAttribute(o.name),m-=1);continue}let d=[];for(;i>=0;){if(i>0&&d.push(a.substr(0,i)),a=a.substr(i+4),i=a.indexOf("}}"),i<0)throw new Error("Katla: Unexpected missing }}");s=parseInt(a.substr(0,i)),d.push(s),a=a.substr(i+2),i=a.indexOf("{{fv")}if(a.length>0&&d.push(a),d.length===1)if(o.name.startsWith("class:")){if(c)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");C.push({class:o.name.substr(6),argidx:d[0]})}else(o.name.charAt(0)==="#"?b:f(this,y)).push(se(l,o.name,d[0]));else{if(o.name.startsWith("class:"))throw new Error("Katla: "+o.name+" attribute must have ${boolean} value");(o.name.charAt(0)==="#"?b:f(this,y)).push(le(l,o.name,d))}u.removeAttribute(o.name),m-=1}C.length>0&&f(this,y).push(pe(l,C)),f(this,y).push(...b),u.tagName.toLowerCase()!=="select"&&R(this,L,K).call(this,n,l)}else if(n.nodeType===8){let u=n;u.data.substr(0,4)==="{{fv"&&(s=parseInt(u.data.substr(4,u.data.length-6)),e.childNodes.length==1?(u.remove(),f(this,y).push(Z(r,s,!0))):(u.data="",e.insertBefore(document.createComment(""),n),f(this,y).push(Z(l,s,!1)),p+=1))}};function ie(t,e,r){return{path:t,CreateOp(n,a,i){let s=o=>r;return k(n,e,s,a,s(i)),null}}}function se(t,e,r){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(n,a,i){let s=o=>o[r];return k(n,e,s,a,s(i))}}}function le(t,e,r){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(n,a,i){let s;return(e==="#bind"||e.substr(0,6)==="#bind|")&&r.length===2&&typeof r[1]=="string"&&r[1].charAt(0)==="."?s=o=>[o[r[0]],r[1].substr(1)]:s=o=>r.map(l=>typeof l=="string"?l:o[l].toString()).join(""),k(n,e,s,a,s(i))}}}function pe(t,e){return{path:t,CreateOp(r,n,a){let i=s=>{let o="",l;for(let p=0;p<e.length;p++){if(l=s[e[p].argidx],typeof l!="boolean")throw new Error("Katla: class:"+e[p].class+" value must be boolean");l&&(o+=(o.length>0?" ":"")+e[p].class)}return o.length===0?!1:o};return k(r,"class",i,n,i(a))}}}function Z(t,e,r){return{path:t,CreateOp(n,a,i){if(r)return T(o=>{n.innerHTML="",o&&n.appendChild(o)},e,a,i[e]);let s=n.nextSibling;return T(o=>{let l=document.createRange();l.setStartAfter(n),l.setEndBefore(s),l.deleteContents(),o&&l.insertNode(o)},e,a,i[e])}}}var N,P,g,O,I=class extends HTMLElement{constructor(){super();h(this,N,void 0);h(this,P,!1);h(this,g,void 0);h(this,O,null);if(W(this),this.constructor.props){w(this,g,{});for(let r in this.constructor.props)r in this&&(f(this,g)[r]=this[r]);for(let r in f(this,g))delete this[r]}}load(){}connectedCallback(){if(!f(this,P)){if(this.constructor.props){for(let r in this.constructor.props)!(r in f(this,g))&&r in this&&(f(this,g)[r]=this[r]);for(let r in f(this,g))delete this[r];for(let r in this.constructor.props)Object.defineProperty(this,r,{get:()=>f(this,g)[r],set:n=>{f(this,g)[r]=n,f(this,N)&&this.$redraw()},configurable:!1,enumerable:!0})}w(this,P,!0),this.load(),w(this,N,T(r=>{this.innerHTML="",r&&this.appendChild(r)},-1,this,this.render()))}}$redraw(){return f(this,P)?(f(this,O)==null&&w(this,O,new Promise((r,n)=>{requestAnimationFrame(()=>{w(this,O,null);try{f(this,N).Update(this.render()),r(),dispatchEvent(new Event("katla:redraw"))}catch(a){console.error(a),n(a)}})})),f(this,O)):Promise.resolve()}static get observedAttributes(){if(!this.props)return[];let r=[];for(let n in this.props)this.props[n]&&r.push(n);return r}attributeChangedCallback(r,n,a){this[r]=typeof this.constructor.props[r]=="function"?this.constructor.props[r](a):a}};N=new WeakMap,P=new WeakMap,g=new WeakMap,O=new WeakMap;var te=new Map;function G(t,...e){let r=te.get(t);return r||(r=new $(t),te.set(t,r)),new x(r,e)}var B=class extends I{RenderApp;render(){return this.RenderApp()}};customElements.define("katla-app",B);function z(t,e){typeof t=="string"&&(t=document.querySelector(t));let r=document.createElement("katla-app");return r.RenderApp=e,t.appendChild(r),()=>r.$redraw()}var E,q=class{constructor(){j(this,"deps");j(this,"render2");h(this,E,void 0)}render(){if(f(this,E)&&f(this,E).length===this.deps.length){let e=!0;for(let r=0;r<f(this,E).length;r++)if(f(this,E)[r]!==this.deps[r]){e=!1;break}if(e)return this.deps=void 0,new F}return w(this,E,Object.assign({},this.deps)),this.deps=void 0,this.render2()}};E=new WeakMap;function re(t,e){if(!t||!Array.isArray(t))throw new Error("Katla: memo deps argument must be array");if(!e||typeof e!="function")throw new Error("Katla: memo render argument must be function");return[q,{deps:t,render2:e}]}var ue=t=>new M(t),fe=(t,e)=>v.set(t,e),me=(t,e)=>({redraw:z(t,e)});globalThis.Katla={app:me,html:G,mount:z,raw:ue,directive:fe,memo:re,WebComponent:I};globalThis.html=G;})();
//# sourceMappingURL=katla.js.map
