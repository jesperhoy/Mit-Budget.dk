/*!Katla v. 3.3.0 - Copyright 2025 Jesper Hoy*/
"use strict";(()=>{var b=class{html;constructor(e){this.html=e}};function P(t,e){let a=document.createElement("template");return a.innerHTML=t.html,e(a.content),{Update:r=>{},Unload:()=>{},MatchForUpdate:r=>r.html===t.html}}var y=new Map;y.set("validity",(t,e,a,r)=>{let o=t;function i(s){if(typeof s!="string")throw new Error("Katla: #validity value must be string");o.setCustomValidity(s)}return i(e),i});y.set("ref",(t,e,a,r)=>{if(typeof e!="function")throw new Error("Katla: #ref value must be function");return e(t),()=>{}});y.set("bind",(t,e,a,r)=>{let o=t.tagName.toLowerCase();o==="input"&&(o=t.type,o||(o="text"),o=o.toLowerCase());let i,s,n,l=a.indexOf("notrim")<0&&(t.tagName=="TEXTAREA"||t.tagName=="INPUT"&&["text","email","search","url"].includes(t.type));function p(){let m=t.value;return(o==="number"||o==="range"||a.indexOf("number")>=0)&&(m=parseInt(m)),l&&(m=m.trim()),m}function u(){if(s=void 0,Array.isArray(e)&&e.length===2)if(Array.isArray(e[0])&&typeof e[1]=="number")i=e[0][e[1]],s=m=>e[0][e[1]]=m;else if(typeof e[0]=="object"&&typeof e[1]=="string"){if(!e[0].hasOwnProperty(e[1]))throw new Error("Katla: "+o+" #bind to object does not have property '"+e[1]+"'");i=e[0][e[1]],s=m=>e[0][e[1]]=m}else typeof e[0]=="function"&&typeof e[1]=="function"?(i=e[0](),s=e[1]):typeof e[1]=="function"&&(i=e[0],s=e[1]);else if(Array.isArray(e)&&e.length===1&&Array.isArray(e[0])){if(o!=="checkbox")throw new Error("Katla: Can only #bind to [Array] with input/checkbox");i=e[0],s=()=>{}}if(!s)throw new Error("Katla: Can only #bind to {object}.PropName / [Object,string] / [Array,number] / [value,setFunc] / [Array]");if(o==="radio"){if(!t.hasAttribute("value"))throw new Error("Katla: input/radio element missing 'value' attribute - for #bind");let m=p(),f=i===m;if(f===n)return;t.checked=f,n=f}else if(o==="checkbox")if(typeof i=="boolean"){if(i===n)return;t.checked=i,n=i;return}else{if(!Array.isArray(i))throw new Error("Katla: #bind value for input/checkbox must be either boolean or array");if(!t.hasAttribute("value"))throw new Error("Katla: input/checkbox element missing 'value' attribute - for #bind with array value");let m=p(),f=i.indexOf(m)>=0;if(f===n)return;t.checked=f,n=f}else if(o==="file")(!i||!i.files||i.files.length===0)&&(t.value="");else{if(i===n)return;t.value=Number.isNaN(i)?"":i.toString(),n=i}}u();function d(m){let f=p();if(o==="radio"){if(!t.checked)return;s(f),n=f}else if(o==="checkbox"){let c=t.checked;if(typeof i=="boolean")s(c);else{let M=i.indexOf(f);c&&M<0&&i.push(f),!c&&M>=0&&i.splice(M,1)}n=c}else o==="file"?(t.id||(t.id="file-"+Math.floor(Math.random()*Date.now()).toString(36)),s({id:t.id,files:Array.from(t.files).map(c=>({name:c.name,size:c.size,type:c.type,lastModified:c.lastModified}))})):(s(f),n=f,l&&m.type==="change"&&t.value!==n&&(t.value=n));a.indexOf("noredraw")<0&&r()}let h=a.indexOf("eager")>=0;return h&&t.addEventListener("input",d),(!h||l)&&t.addEventListener("change",d),m=>{e=m,u()}});function A(t,e,a,r,o){let i=o,s;if(e.charAt(0)==="@"){if(typeof o!="function")throw new Error("Katla: '"+e+"' handler must be function");let n=e.substr(1).split("|");t.addEventListener(n[0],l=>{if(n.indexOf("self")>0&&l.target!==t)return;n.indexOf("prevent")>0&&l.preventDefault(),n.indexOf("stop")>0&&l.stopPropagation();let p=i(l);n.includes("noredraw")||(p instanceof Promise?p.then(()=>r.$redraw()):r.$redraw())},{capture:n.indexOf("capture")>0,once:n.indexOf("once")>0,passive:n.indexOf("passive")>0})}else if(e.charAt(0)===".")t[e.substr(1)]=o;else if(e.charAt(0)==="#"){let n=e.substr(1).split("|"),l=y.get(n[0]);if(l===void 0)throw new Error("Katla: Unknown directive '#"+n[0]+"'");s=l(t,o,n.slice(1),()=>r.$redraw())}else o===!1||o===null||o===void 0||(o===!0?t.setAttribute(e,""):t.setAttribute(e,o.toString()));return{GetData:a,Update:n=>{if(!(n===i&&typeof n!="object"))if(i=n,e.charAt(0)==="@"){if(typeof n!="function")throw new Error("Katla: "+e+" handler must be function")}else e.charAt(0)==="."?t[e.substr(1)]=n:e.charAt(0)==="#"?s(n):n===!1||n===null||n===void 0?t.removeAttribute(e):n===!0?t.setAttribute(e,""):t.setAttribute(e,n.toString())},Unload:()=>{}}}function I(t,e,a){let r=t.bldr.MakeLive(t.args,a);return e(r.ContentNode),{Update:o=>r.Update(o.args),Unload:r.Unload,MatchForUpdate:o=>o.bldr===t.bldr}}var w=class{bldr;args;constructor(e,a){this.bldr=e,this.args=a}};function R(t,e){let a=document.createTextNode(t.toString());return e(a),{Update:r=>{r!==t&&(t=r,a.data=r.toString())},Unload:()=>{},MatchForUpdate:r=>!0}}function x(t,e=null){let a;t.$get=r=>{if(a&&a.has(r))return a.get(r);if(e)return e.$get(r)},t.$set=(r,o)=>{a||(a=new Map),a.set(r,o)}}function k(t,e,a){let r=new t[0];if(r.$parent=a,r.$redraw=()=>a.$redraw(),r.$app={redraw:()=>a.$redraw()},x(r,a),t.length>1&&Object.assign(r,t[1]),t.length>2&&t[2](r),r.load&&r.load(),!r.render||typeof r.render!="function")throw new Error("Katla: Component must have .render method");let o=r.render(),i=g(o),s=E(o,e,r),n=!1;return{Update:l=>{if(n)return;t=l,t.length>1&&Object.assign(r,t[1]),o=r.render();let p=g(o);p!==5&&(i===p&&s.MatchForUpdate(o)?s.Update(o):(s.Unload(),i=p,s=E(o,e,r)))},Unload:()=>{n||(r.unload&&r.unload(),s.Unload(),n=!0)},MatchForUpdate:l=>t[0]===l[0]}}function F(t,e,a){let r=[],o=[];function i(p){let u=r.length,d=document.createComment(""),h=o[u];o.splice(u,0,d),h.parentNode.insertBefore(d,h),r.push(C(m=>{let f=document.createRange();f.setStartAfter(o[u]),f.setEndBefore(o[u+1]),f.deleteContents(),m&&f.insertNode(m)},-1,a,p))}function s(p){let u=document.createRange();u.setStartAfter(o[p]),u.setEndAfter(o[p+1]),u.deleteContents(),o.splice(p+1,1),r[p].Unload(),r.splice(p,1)}let n=new DocumentFragment,l=document.createComment("");o.push(l),n.append(l);for(let p of t)i(p);return e(n),{Update:p=>{for(let u=0;u<p.length||u<r.length;u++)u<p.length&&u<r.length?r[u].Update(p[u]):p.length<r.length?(s(u),u-=1):i(p[u])},Unload:()=>{r.forEach(p=>p.Unload()),r=[]},MatchForUpdate:p=>!0}}function g(t){if(t===null||t===""||t===!1)return 0;if(t instanceof w)return 4;if(Array.isArray(t))return t.length>0&&typeof t[0]=="function"?2:6;if(t instanceof b)return 3;if(t instanceof T)return 5;if(typeof t=="string"||typeof t=="number"||typeof t=="object")return 1;throw new Error("Katla: Unknown content type: "+typeof t)}function E(t,e,a){switch(g(t)){case 0:return e(null),{Update:o=>{},Unload:()=>{},MatchForUpdate:o=>!0};case 1:return R(t,e);case 2:return k(t,e,a);case 3:return P(t,e);case 4:return I(t,e,a);case 6:return F(t,e,a);case 5:throw new Error("Katla: NoChange at creation")}}var T=class{};function C(t,e,a,r){let o=g(r),i,s={GetData:n=>n[e],Update:n=>{let l=g(n);l!==5&&(o===l&&i.MatchForUpdate(n)?i.Update(n):(i.Unload(),o=l,i=E(n,t,a)))},Unload:()=>()=>i.Unload()};return i=E(r,t,a),s}var O=class{#e=[];#n=document.createElement("template");constructor(e){let a="";for(let r=0;r<e.length-1;r++)a+=e[r],a+=this.#t(a)?"{{fv"+r+"}}":"<!--{{fv"+r+"}}-->";a+=e[e.length-1],this.#n.innerHTML=a,this.#r(this.#n.content,[])}#t(e){return e.lastIndexOf("<")>e.lastIndexOf(">")}#r(e,a){let r,o,i,s,n,l;for(let p=0;p<e.childNodes.length;p++)if(r=e.childNodes[p],l=a.concat(p),r.nodeType===1){let u=r;u.tagName.toLowerCase()==="select"&&this.#r(r,l);let d=[],h=[],m=!1;for(let f=0;f<u.attributes.length;f++){if(n=u.attributes[f],n.name==="class"){if(d.length>0)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");m=!0}if(o=n.value,i=o.indexOf("{{fv"),i<0){if(n.name.startsWith("class:"))throw new Error("Katla: "+n.name+" attribute must have ${boolean} value");(n.name.charAt(0)==="#"||n.name.charAt(0)===".")&&((n.name.charAt(0)==="#"?h:this.#e).push(j(l,n.name,o)),u.removeAttribute(n.name),f-=1);continue}let c=[];for(;i>=0;){if(i>0&&c.push(o.substr(0,i)),o=o.substr(i+4),i=o.indexOf("}}"),i<0)throw new Error("Katla: Unexpected missing }}");s=parseInt(o.substr(0,i)),c.push(s),o=o.substr(i+2),i=o.indexOf("{{fv")}if(o.length>0&&c.push(o),c.length===1)if(n.name.startsWith("class:")){if(m)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");d.push({class:n.name.substr(6),argidx:c[0]})}else(n.name.charAt(0)==="#"?h:this.#e).push(V(l,n.name,c[0]));else{if(n.name.startsWith("class:"))throw new Error("Katla: "+n.name+" attribute must have ${boolean} value");(n.name.charAt(0)==="#"?h:this.#e).push(W(l,n.name,c))}u.removeAttribute(n.name),f-=1}d.length>0&&this.#e.push(B(l,d)),this.#e.push(...h),u.tagName.toLowerCase()!=="select"&&this.#r(r,l)}else if(r.nodeType===8){let u=r;u.data.substr(0,4)==="{{fv"&&(s=parseInt(u.data.substr(4,u.data.length-6)),e.childNodes.length==1?(u.remove(),this.#e.push(K(a,s,!0))):(u.data="",e.insertBefore(document.createComment(""),r),this.#e.push(K(l,s,!1)),p+=1))}}MakeLive(e,a){let r=this.#n.content.cloneNode(!0),o=this.#e.map(i=>{let s=r;return i.path.forEach(n=>s=s.childNodes[n]),{ph:i,n:s}}).map(i=>i.ph.CreateOp(i.n,a,e)).filter(i=>i!==null);return{ContentNode:r,Update:i=>{for(let s of o)s.Update(s.GetData(i))},Unload:()=>{for(let i of o)i.Unload()}}}};function j(t,e,a){return{path:t,CreateOp(r,o,i){let s=n=>a;return A(r,e,s,o,s(i)),null}}}function V(t,e,a){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(r,o,i){let s=n=>n[a];return A(r,e,s,o,s(i))}}}function W(t,e,a){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(r,o,i){let s;return(e==="#bind"||e.substr(0,6)==="#bind|")&&a.length===2&&typeof a[1]=="string"&&a[1].charAt(0)==="."?s=n=>[n[a[0]],a[1].substr(1)]:s=n=>a.map(l=>typeof l=="string"?l:n[l].toString()).join(""),A(r,e,s,o,s(i))}}}function B(t,e){return{path:t,CreateOp(a,r,o){let i=s=>{let n="",l;for(let p=0;p<e.length;p++){if(l=s[e[p].argidx],typeof l!="boolean")throw new Error("Katla: class:"+e[p].class+" value must be boolean");l&&(n+=(n.length>0?" ":"")+e[p].class)}return n.length===0?!1:n};return A(a,"class",i,r,i(o))}}}function K(t,e,a){return{path:t,CreateOp(r,o,i){if(a)return C(n=>{r.innerHTML="",n&&r.appendChild(n)},e,o,i[e]);let s=r.nextSibling;return C(n=>{let l=document.createRange();l.setStartAfter(r),l.setEndBefore(s),l.deleteContents(),n&&l.insertNode(n)},e,o,i[e])}}}var v=class extends HTMLElement{load(){}#e;#n=!1;#t;constructor(){if(super(),x(this),this.constructor.props){this.#t={};for(let e in this.constructor.props)e in this&&(this.#t[e]=this[e]);for(let e in this.#t)delete this[e]}}connectedCallback(){if(!this.#n){if(this.constructor.props){for(let e in this.constructor.props)!(e in this.#t)&&e in this&&(this.#t[e]=this[e]);for(let e in this.#t)delete this[e];for(let e in this.constructor.props)Object.defineProperty(this,e,{get:()=>this.#t[e],set:a=>{this.#t[e]=a,this.#e&&this.$redraw()},configurable:!1,enumerable:!0})}this.#n=!0,this.load(),this.#e=C(e=>{this.innerHTML="",e&&this.appendChild(e)},-1,this,this.render())}}#r=null;$redraw(){return this.#n?(this.#r==null&&(this.#r=new Promise((e,a)=>{requestAnimationFrame(()=>{this.#r=null;try{this.#e.Update(this.render()),e(),dispatchEvent(new Event("katla:redraw"))}catch(r){console.error(r),a(r)}})})),this.#r):Promise.resolve()}static get observedAttributes(){if(!this.props)return[];let e=[];for(let a in this.props)this.props[a]&&e.push(a);return e}attributeChangedCallback(e,a,r){this[e]=this.constructor.props[e](r)}};var $=new Map;function U(t,...e){let a=$.get(t);return a||(a=new O(t),$.set(t,a)),new w(a,e)}var H=class extends v{RenderApp;render(){return this.RenderApp()}};customElements.define("katla-app",H);function L(t,e){typeof t=="string"&&(t=document.querySelector(t));let a=document.createElement("katla-app");return a.RenderApp=e,t.appendChild(a),()=>a.$redraw()}var N=class{deps;render2;#e;render(){if(this.#e&&this.#e.length===this.deps.length){let e=!0;for(let a=0;a<this.#e.length;a++)if(this.#e[a]!==this.deps[a]){e=!1;break}if(e)return this.deps=void 0,new T}return this.#e=Object.assign({},this.deps),this.deps=void 0,this.render2()}};function S(t,e){if(!t||!Array.isArray(t))throw new Error("Katla: memo deps argument must be array");if(!e||typeof e!="function")throw new Error("Katla: memo render argument must be function");return[N,{deps:t,render2:e}]}var G=t=>new b(t),z=(t,e)=>y.set(t,e),q=(t,e)=>({redraw:L(t,e)});globalThis.Katla={app:q,html:U,mount:L,raw:G,directive:z,memo:S,WebComponent:v};globalThis.html=U;})();
//# sourceMappingURL=katla.js.map
