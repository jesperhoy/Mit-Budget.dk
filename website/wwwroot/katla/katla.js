/*!Katla v. 3.4.0 - Copyright 2025 Jesper Hoy*/
"use strict";(()=>{var b=class{html;constructor(e){this.html=e}};function P(t,e){let o=document.createElement("template");return o.innerHTML=t.html,e(o.content),{Update:r=>{},Unload:()=>{},MatchForUpdate:r=>r.html===t.html}}var y=new Map;y.set("validity",(t,e,o,r)=>{let a=t;function i(s){if(typeof s!="string")throw new Error("Katla: #validity value must be string");a.setCustomValidity(s)}return i(e),i});y.set("ref",(t,e,o,r)=>{if(typeof e!="function")throw new Error("Katla: #ref value must be function");return e(t),()=>{}});y.set("bind",(t,e,o,r)=>{let a=t.tagName.toLowerCase();a==="input"&&(a=t.type,a||(a="text"),a=a.toLowerCase());let i,s,n,l=o.indexOf("notrim")<0&&(t.tagName=="TEXTAREA"||t.tagName=="INPUT"&&["text","email","search","url"].includes(t.type));function p(){let m=t.value;return(a==="number"||a==="range"||o.indexOf("number")>=0)&&(m=parseInt(m)),l&&(m=m.trim()),m}function u(){if(s=void 0,Array.isArray(e)&&e.length===2)if(Array.isArray(e[0])&&typeof e[1]=="number")i=e[0][e[1]],s=m=>e[0][e[1]]=m;else if(typeof e[0]=="object"&&typeof e[1]=="string"){if(!e[0].hasOwnProperty(e[1]))throw new Error("Katla: "+a+" #bind to object does not have property '"+e[1]+"'");i=e[0][e[1]],s=m=>e[0][e[1]]=m}else typeof e[0]=="function"&&typeof e[1]=="function"?(i=e[0](),s=e[1]):typeof e[1]=="function"&&(i=e[0],s=e[1]);else if(Array.isArray(e)&&e.length===1&&Array.isArray(e[0])){if(a!=="checkbox")throw new Error("Katla: Can only #bind to [Array] with input/checkbox");i=e[0],s=()=>{}}if(!s)throw new Error("Katla: Can only #bind to {object}.PropName / [Object,string] / [Array,number] / [value,setFunc] / [Array]");if(a==="radio"){if(!t.hasAttribute("value"))throw new Error("Katla: input/radio element missing 'value' attribute - for #bind");let m=p(),f=i===m;if(f===n)return;t.checked=f,n=f}else if(a==="checkbox")if(typeof i=="boolean"){if(i===n)return;t.checked=i,n=i;return}else{if(!Array.isArray(i))throw new Error("Katla: #bind value for input/checkbox must be either boolean or array");if(!t.hasAttribute("value"))throw new Error("Katla: input/checkbox element missing 'value' attribute - for #bind with array value");let m=p(),f=i.indexOf(m)>=0;if(f===n)return;t.checked=f,n=f}else if(a==="file")(!i||!i.files||i.files.length===0)&&(t.value="");else{if(i===n)return;t.value=Number.isNaN(i)?"":i.toString(),n=i}}u();function d(m){let f=p();if(a==="radio"){if(!t.checked)return;s(f),n=f}else if(a==="checkbox"){let c=t.checked;if(typeof i=="boolean")s(c);else{let M=i.indexOf(f);c&&M<0&&i.push(f),!c&&M>=0&&i.splice(M,1)}n=c}else a==="file"?(t.id||(t.id="file-"+Math.floor(Math.random()*Date.now()).toString(36)),s({id:t.id,files:Array.from(t.files).map(c=>({name:c.name,size:c.size,type:c.type,lastModified:c.lastModified}))})):(s(f),n=f,l&&m.type==="change"&&t.value!==n&&(t.value=n));o.indexOf("noredraw")<0&&r()}let h=o.indexOf("eager")>=0;return h&&t.addEventListener("input",d),(!h||l)&&t.addEventListener("change",d),m=>{e=m,u()}});function A(t,e,o,r,a){let i=a,s;if(e.charAt(0)==="@"){if(typeof a!="function")throw new Error("Katla: '"+e+"' handler must be function");let n=e.substr(1).split("|");t.addEventListener(n[0],l=>{if(n.indexOf("self")>0&&l.target!==t)return;n.indexOf("default")<1&&l.preventDefault(),n.indexOf("stop")>0&&l.stopPropagation();let p=i(l);n.includes("noredraw")||(p instanceof Promise?p.then(()=>r.$redraw()):r.$redraw())},{capture:n.indexOf("capture")>0,once:n.indexOf("once")>0,passive:n.indexOf("passive")>0})}else if(e.charAt(0)===".")t[e.substr(1)]=a;else if(e.charAt(0)==="#"){let n=e.substr(1).split("|"),l=y.get(n[0]);if(l===void 0)throw new Error("Katla: Unknown directive '#"+n[0]+"'");s=l(t,a,n.slice(1),()=>r.$redraw())}else a===!1||a===null||a===void 0||(a===!0?t.setAttribute(e,""):t.setAttribute(e,a.toString()));return{GetData:o,Update:n=>{if(!(n===i&&typeof n!="object"))if(i=n,e.charAt(0)==="@"){if(typeof n!="function")throw new Error("Katla: "+e+" handler must be function")}else e.charAt(0)==="."?t[e.substr(1)]=n:e.charAt(0)==="#"?s(n):n===!1||n===null||n===void 0?t.removeAttribute(e):n===!0?t.setAttribute(e,""):t.setAttribute(e,n.toString())},Unload:()=>{}}}function I(t,e,o){let r=t.bldr.MakeLive(t.args,o);return e(r.ContentNode),{Update:a=>r.Update(a.args),Unload:r.Unload,MatchForUpdate:a=>a.bldr===t.bldr}}var w=class{bldr;args;constructor(e,o){this.bldr=e,this.args=o}};function R(t,e){let o=document.createTextNode(t.toString());return e(o),{Update:r=>{r!==t&&(t=r,o.data=r.toString())},Unload:()=>{},MatchForUpdate:r=>!0}}function x(t,e=null){let o;t.$get=r=>{if(o&&o.has(r))return o.get(r);if(e)return e.$get(r)},t.$set=(r,a)=>{o||(o=new Map),o.set(r,a)}}function k(t,e,o){let r=new t[0];if(r.$parent=o,r.$redraw=()=>o.$redraw(),r.$app={redraw:()=>o.$redraw()},x(r,o),t.length>1&&Object.assign(r,t[1]),t.length>2&&t[2](r),r.load&&r.load(),!r.render||typeof r.render!="function")throw new Error("Katla: Component must have .render method");let a=r.render(),i=g(a),s=E(a,e,r),n=!1;return{Update:l=>{if(n)return;t=l,t.length>1&&Object.assign(r,t[1]),a=r.render();let p=g(a);p!==5&&(i===p&&s.MatchForUpdate(a)?s.Update(a):(s.Unload(),i=p,s=E(a,e,r)))},Unload:()=>{n||(r.unload&&r.unload(),s.Unload(),n=!0)},MatchForUpdate:l=>t[0]===l[0]}}function F(t,e,o){let r=[],a=[];function i(p){let u=r.length,d=document.createComment(""),h=a[u];a.splice(u,0,d),h.parentNode.insertBefore(d,h),r.push(C(m=>{let f=document.createRange();f.setStartAfter(a[u]),f.setEndBefore(a[u+1]),f.deleteContents(),m&&f.insertNode(m)},-1,o,p))}function s(p){let u=document.createRange();u.setStartAfter(a[p]),u.setEndAfter(a[p+1]),u.deleteContents(),a.splice(p+1,1),r[p].Unload(),r.splice(p,1)}let n=new DocumentFragment,l=document.createComment("");a.push(l),n.append(l);for(let p of t)i(p);return e(n),{Update:p=>{for(let u=0;u<p.length||u<r.length;u++)u<p.length&&u<r.length?r[u].Update(p[u]):p.length<r.length?(s(u),u-=1):i(p[u])},Unload:()=>{r.forEach(p=>p.Unload()),r=[]},MatchForUpdate:p=>!0}}function g(t){if(t===null||t===""||t===!1)return 0;if(t instanceof w)return 4;if(Array.isArray(t))return t.length>0&&typeof t[0]=="function"?2:6;if(t instanceof b)return 3;if(t instanceof T)return 5;if(typeof t=="string"||typeof t=="number"||typeof t=="object")return 1;throw new Error("Katla: Unknown content type: "+typeof t)}function E(t,e,o){switch(g(t)){case 0:return e(null),{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>!0};case 1:return R(t,e);case 2:return k(t,e,o);case 3:return P(t,e);case 4:return I(t,e,o);case 6:return F(t,e,o);case 5:throw new Error("Katla: NoChange at creation")}}var T=class{};function C(t,e,o,r){let a=g(r),i,s={GetData:n=>n[e],Update:n=>{let l=g(n);l!==5&&(a===l&&i.MatchForUpdate(n)?i.Update(n):(i.Unload(),a=l,i=E(n,t,o)))},Unload:()=>()=>i.Unload()};return i=E(r,t,o),s}var O=class{#e=[];#n=document.createElement("template");constructor(e){let o="";for(let r=0;r<e.length-1;r++)o+=e[r],o+=this.#t(o)?"{{fv"+r+"}}":"<!--{{fv"+r+"}}-->";o+=e[e.length-1],this.#n.innerHTML=o,this.#r(this.#n.content,[])}#t(e){return e.lastIndexOf("<")>e.lastIndexOf(">")}#r(e,o){let r,a,i,s,n,l;for(let p=0;p<e.childNodes.length;p++)if(r=e.childNodes[p],l=o.concat(p),r.nodeType===1){let u=r;u.tagName.toLowerCase()==="select"&&this.#r(r,l);let d=[],h=[],m=!1;for(let f=0;f<u.attributes.length;f++){if(n=u.attributes[f],n.name==="class"){if(d.length>0)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");m=!0}if(a=n.value,i=a.indexOf("{{fv"),i<0){if(n.name.startsWith("class:"))throw new Error("Katla: "+n.name+" attribute must have ${boolean} value");(n.name.charAt(0)==="#"||n.name.charAt(0)===".")&&((n.name.charAt(0)==="#"?h:this.#e).push(j(l,n.name,a)),u.removeAttribute(n.name),f-=1);continue}let c=[];for(;i>=0;){if(i>0&&c.push(a.substr(0,i)),a=a.substr(i+4),i=a.indexOf("}}"),i<0)throw new Error("Katla: Unexpected missing }}");s=parseInt(a.substr(0,i)),c.push(s),a=a.substr(i+2),i=a.indexOf("{{fv")}if(a.length>0&&c.push(a),c.length===1)if(n.name.startsWith("class:")){if(m)throw new Error("Katla: Cannot combine 'class' and 'class:...' attributes on same element");d.push({class:n.name.substr(6),argidx:c[0]})}else(n.name.charAt(0)==="#"?h:this.#e).push(V(l,n.name,c[0]));else{if(n.name.startsWith("class:"))throw new Error("Katla: "+n.name+" attribute must have ${boolean} value");(n.name.charAt(0)==="#"?h:this.#e).push(W(l,n.name,c))}u.removeAttribute(n.name),f-=1}d.length>0&&this.#e.push(B(l,d)),this.#e.push(...h),u.tagName.toLowerCase()!=="select"&&this.#r(r,l)}else if(r.nodeType===8){let u=r;u.data.substr(0,4)==="{{fv"&&(s=parseInt(u.data.substr(4,u.data.length-6)),e.childNodes.length==1?(u.remove(),this.#e.push(K(o,s,!0))):(u.data="",e.insertBefore(document.createComment(""),r),this.#e.push(K(l,s,!1)),p+=1))}}MakeLive(e,o){let r=this.#n.content.cloneNode(!0),a=this.#e.map(i=>{let s=r;return i.path.forEach(n=>s=s.childNodes[n]),{ph:i,n:s}}).map(i=>i.ph.CreateOp(i.n,o,e)).filter(i=>i!==null);return{ContentNode:r,Update:i=>{for(let s of a)s.Update(s.GetData(i))},Unload:()=>{for(let i of a)i.Unload()}}}};function j(t,e,o){return{path:t,CreateOp(r,a,i){let s=n=>o;return A(r,e,s,a,s(i)),null}}}function V(t,e,o){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(r,a,i){let s=n=>n[o];return A(r,e,s,a,s(i))}}}function W(t,e,o){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(r,a,i){let s;return(e==="#bind"||e.substr(0,6)==="#bind|")&&o.length===2&&typeof o[1]=="string"&&o[1].charAt(0)==="."?s=n=>[n[o[0]],o[1].substr(1)]:s=n=>o.map(l=>typeof l=="string"?l:n[l].toString()).join(""),A(r,e,s,a,s(i))}}}function B(t,e){return{path:t,CreateOp(o,r,a){let i=s=>{let n="",l;for(let p=0;p<e.length;p++){if(l=s[e[p].argidx],typeof l!="boolean")throw new Error("Katla: class:"+e[p].class+" value must be boolean");l&&(n+=(n.length>0?" ":"")+e[p].class)}return n.length===0?!1:n};return A(o,"class",i,r,i(a))}}}function K(t,e,o){return{path:t,CreateOp(r,a,i){if(o)return C(n=>{r.innerHTML="",n&&r.appendChild(n)},e,a,i[e]);let s=r.nextSibling;return C(n=>{let l=document.createRange();l.setStartAfter(r),l.setEndBefore(s),l.deleteContents(),n&&l.insertNode(n)},e,a,i[e])}}}var v=class extends HTMLElement{load(){}#e;#n=!1;#t;constructor(){if(super(),x(this),this.constructor.props){this.#t={};for(let e in this.constructor.props)e in this&&(this.#t[e]=this[e]);for(let e in this.#t)delete this[e]}}connectedCallback(){if(!this.#n){if(this.constructor.props){for(let e in this.constructor.props)!(e in this.#t)&&e in this&&(this.#t[e]=this[e]);for(let e in this.#t)delete this[e];for(let e in this.constructor.props)Object.defineProperty(this,e,{get:()=>this.#t[e],set:o=>{this.#t[e]=o,this.#e&&this.$redraw()},configurable:!1,enumerable:!0})}this.#n=!0,this.load(),this.#e=C(e=>{this.innerHTML="",e&&this.appendChild(e)},-1,this,this.render())}}#r=null;$redraw(){return this.#n?(this.#r==null&&(this.#r=new Promise((e,o)=>{requestAnimationFrame(()=>{this.#r=null;try{this.#e.Update(this.render()),e(),dispatchEvent(new Event("katla:redraw"))}catch(r){console.error(r),o(r)}})})),this.#r):Promise.resolve()}static get observedAttributes(){if(!this.props)return[];let e=[];for(let o in this.props)this.props[o]&&e.push(o);return e}attributeChangedCallback(e,o,r){this[e]=typeof this.constructor.props[e]=="function"?this.constructor.props[e](r):r}};var $=new Map;function U(t,...e){let o=$.get(t);return o||(o=new O(t),$.set(t,o)),new w(o,e)}var H=class extends v{RenderApp;render(){return this.RenderApp()}};customElements.define("katla-app",H);function L(t,e){typeof t=="string"&&(t=document.querySelector(t));let o=document.createElement("katla-app");return o.RenderApp=e,t.appendChild(o),()=>o.$redraw()}var N=class{deps;render2;#e;render(){if(this.#e&&this.#e.length===this.deps.length){let e=!0;for(let o=0;o<this.#e.length;o++)if(this.#e[o]!==this.deps[o]){e=!1;break}if(e)return this.deps=void 0,new T}return this.#e=Object.assign({},this.deps),this.deps=void 0,this.render2()}};function S(t,e){if(!t||!Array.isArray(t))throw new Error("Katla: memo deps argument must be array");if(!e||typeof e!="function")throw new Error("Katla: memo render argument must be function");return[N,{deps:t,render2:e}]}var G=t=>new b(t),z=(t,e)=>y.set(t,e),q=(t,e)=>({redraw:L(t,e)});globalThis.Katla={app:q,html:U,mount:L,raw:G,directive:z,memo:S,WebComponent:v};globalThis.html=U;})();
//# sourceMappingURL=katla.js.map
