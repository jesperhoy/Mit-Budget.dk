/*!FrontView v. 0.6.9 - Copyright 2023 Jesper HÃ¸y*/
"use strict";(()=>{var Y=Object.defineProperty;var Z=(t,e,n)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>(Z(t,typeof e!="symbol"?e+"":e,n),n),I=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var c=(t,e,n)=>(I(t,e,"read from private field"),n?n.call(t):e.get(t)),w=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},B=(t,e,n,o)=>(I(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);var N=(t,e,n)=>(I(t,e,"access private method"),n);var u=class extends Error{constructor(n,o,a){super(n,{cause:a});h(this,"ctx");this.ctx=o,this.name="FrontViewError"}};var b=new Map;b.set("validity",(t,e,n,o)=>{let a=t;function i(p){if(typeof p!="string")throw new u("#validity value must be string");a.setCustomValidity(""),!!a.checkValidity()&&p!==""&&a.setCustomValidity(p)}return i(e),p=>{e=p,i(p)}});b.set("ref",(t,e,n,o)=>{if(typeof e!="function")throw new u("#ref value must be function");return e(t),()=>{}});b.set("bind",(t,e,n,o)=>{let a=t.tagName.toLowerCase();a==="input"&&(a=t.type,a||(a="text"),a=a.toLowerCase());let i,p,r;function l(){let f=t.value;return(a==="number"||a==="range"||n.indexOf("number")>=0)&&(f=parseInt(f)),n.indexOf("trim")>=0&&(f=f.trim()),f}function s(){if(p=void 0,Array.isArray(e)&&e.length===2)if(Array.isArray(e[0])&&typeof e[1]=="number")i=e[0][e[1]],p=f=>e[0][e[1]]=f;else if(typeof e[0]=="object"&&typeof e[1]=="string"){if(!e[0].hasOwnProperty(e[1]))throw new u(a+" #bind to object does not have property '"+e[1]+"'");i=e[0][e[1]],p=f=>e[0][e[1]]=f}else typeof e[0]=="function"&&typeof e[1]=="function"?(i=e[0](),p=e[1]):typeof e[1]=="function"&&(i=e[0],p=e[1]);else if(Array.isArray(e)&&e.length===1&&Array.isArray(e[0])){if(a!=="checkbox")throw new u("Can only #bind to [Array] with input/checkbox");i=e[0],p=()=>{}}if(!p)throw new u("Can only #bind to {object}.PropName / [Object,string] / [Array,number] / [getFunc,setFunc]");if(a==="radio"){if(!t.hasAttribute("value"))throw new u("input/radio element missing 'value' attribute - for #bind");let f=l(),d=i===f;if(d===r)return;t.checked=d,r=d}else if(a==="checkbox")if(typeof i=="boolean"){if(i===r)return;t.checked=i,r=i;return}else{if(!Array.isArray(i))throw new u("#bind value for input/checkbox must be either boolean or array");if(!t.hasAttribute("value"))throw new u("input/checkbox element missing 'value' attribute - for #bind with array value");let f=l(),d=i.indexOf(f)>=0;if(d===r)return;t.checked=d,r=d}else{if(i===r)return;t.value=Number.isNaN(i)?"":i.toString(),r=i}}function m(){let f=l();if(a==="radio"){if(!t.checked)return;p(f),r=f}else if(a==="checkbox"){let d=t.checked;if(typeof i=="boolean")p(d);else{let A=i.indexOf(f);d&&A<0&&i.push(f),!d&&A>=0&&i.splice(A,1)}r=d}else p(f),r=f}return s(),t.addEventListener(n.indexOf("eager")>=0?"input":"change",f=>{m(),o.autoRedraw?n.indexOf("noredraw")<0&&o.redraw():n.indexOf("redraw")>=0&&o.redraw()}),f=>{e=f,s()}});function F(t,e,n,o,a){let i=a,p;if(e.charAt(0)==="@"){if(typeof a!="function")throw new u(e+" handler must be function",o);let r=e.substr(1).split("|"),l={capture:r.indexOf("capture")>0,once:r.indexOf("once")>0,passive:r.indexOf("passive")>0};t.addEventListener(r[0],s=>{r.indexOf("self")>0&&s.target!==t||(r.indexOf("prevent")>0&&s.preventDefault(),r.indexOf("stop")>0&&s.stopPropagation(),i(s),o.app.autoRedraw?r.indexOf("noredraw")<0&&o.app.redraw():r.indexOf("redraw")>0&&o.app.redraw())},l)}else if(e.charAt(0)===".")t[e.substr(1)]=a;else if(e.charAt(0)==="#"){let r=e.substr(1).split("|"),l=b.get(r[0]);if(l===void 0)throw new u("Unknown directive '#"+r[0]+"'",o);p=l(t,a,r.slice(1),o.app)}else a===!1||a===null||a===void 0||(a===!0?t.setAttribute(e,""):t.setAttribute(e,a.toString()));return{GetData:n,Update:r=>{if(!(r===i&&typeof r!="object"))if(i=r,e.charAt(0)==="@"){if(typeof r!="function")throw new u(e+" handler must be function",o)}else e.charAt(0)==="."?t[e.substr(1)]=r:e.charAt(0)==="#"?p(r):r===!1||r===null||r===void 0?t.removeAttribute(e):r===!0?t.setAttribute(e,""):t.setAttribute(e,r.toString())},Unload:()=>{}}}function $(t,e,n){let o=t.bldr.MakeLive(t.args,e.node2,n);return{Update:a=>o.Update(a.args),Unload:o.Unload,MatchForUpdate:a=>a.bldr===t.bldr}}var T=class{constructor(e,n){h(this,"bldr");h(this,"args");this.bldr=e,this.args=n}};var U=class{constructor(e){h(this,"html");this.html=e}};function W(t,e,n){let o=document.createElement("template");return o.innerHTML=t.html,e.node2.parentNode.insertBefore(o.content,e.node2),{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>a.html===t.html}}function G(t,e,n){let o=document.createTextNode(t.toString());return e.node2.parentNode.insertBefore(o,e.node2),{Update:a=>{a!==t&&(t=a,o.data=a.toString())},Unload:()=>{},MatchForUpdate:a=>!0}}var v=class{constructor(e,n,o){h(this,"app");h(this,"component");h(this,"parent");h(this,"values",new Map);this.app=e,this.parent=n,this.component=o}setValue(e,n){this.values.set(e,n)}getValue(e){let n=this.values.get(e);if(n!==void 0)return n;if(this.parent!==void 0)return this.parent.getValue(e)}};function _(t,e,n){let o=new t[0];o.$app=n.app,o.$parent=n.component;let a=new v(n.app,n,o);if(o.$get=s=>a.getValue(s),o.$set=(s,m)=>a.setValue(s,m),o.$redraw=l,t.length>1&&Object.assign(o,t[1]),o.load&&o.load(),!o.render)throw new u("Component object must have .render property",n);if(typeof o.render!="function")throw new u("Component .render property must be a function",n);t.length>2&&t[2](o);let i=o.render(),p=O(i,n),r=M(i,e,a);function l(){t.length>1&&Object.assign(o,t[1]),i=o.render();let s=O(i,n);s!==5&&(p===s&&r.MatchForUpdate(i)?r.Update(i):(r.Unload(),e.ClearContent(),p=s,r=M(i,e,a)))}return{Update:s=>{!o||(t=s,l())},Unload:()=>{o.unload&&o.unload(),r.Unload(),o=void 0},MatchForUpdate:s=>s[0]===t[0]}}function q(t,e,n){let o=[];a(t);function a(i){if(i.length===0)return;let p=document.createDocumentFragment(),r=document.createComment("");p.append(r);let l,s;for(let m of i)s=document.createComment(""),p.append(s),l=x(r,-1,n,m),o.push(l),r=s;e.node2.parentNode.insertBefore(p,e.node2)}return{Update:i=>{if(o.length===0){a(i);return}if(i.length===0){e.ClearContent(),o=[];return}let p,r;for(let l=0;l<i.length||l<o.length;l++)if(l<i.length&&l<o.length)o[l].Update(i[l]);else if(i.length<o.length)p=o[l],p.Unload(),p.ClearContent(),p.node1.parentNode.removeChild(p.node1),o[l-1].node2=p.node2,o.splice(l,1),l-=1;else{let s=document.createComment("");p=o[o.length-1],p.node2.parentNode.insertBefore(s,p.node2),r=x(s,-1,n,i[l]),p.node2=s,o.push(r)}},Unload:()=>{o.forEach(i=>i.Unload()),o=[]},MatchForUpdate:i=>!0}}function O(t,e){if(t===null||t==="")return 0;if(t instanceof T)return 4;if(Array.isArray(t)){if(t.length>0&&typeof t[0]=="function"){if(t.length>1){if(typeof t[1]!="object")throw new u("Component props must be object",e);if(["render","load","unload","context"].forEach(n=>{if(t[1].hasOwnProperty(n))throw new u("Invalid component props property name: '"+n+"'",e)}),t.length>2&&typeof t[2]!="function")throw new u("Component ref must be function",e)}return 2}return 6}if(t instanceof U)return 3;if(t instanceof V)return 5;if(typeof t=="string"||typeof t=="number"||typeof t=="object")return 1;throw new u("Unknown content var type: "+typeof t,e)}function M(t,e,n){switch(O(t,n)){case 0:return{Update:a=>{},Unload:()=>{},MatchForUpdate:a=>!0};case 1:return G(t,e,n);case 2:return _(t,e,n);case 3:return W(t,e,n);case 4:return $(t,e,n);case 6:return q(t,e,n);case 5:throw new u("NoChange at creation",n)}}var V=class{};function x(t,e,n,o){let a=O(o,n),i,p={GetData:r=>r[e],node1:t,node2:t.nextSibling,Update:r=>{let l=O(r,n);l!==5&&(a===l&&i.MatchForUpdate(r)?i.Update(r):(i.Unload(),p.ClearContent(),a=l,i=M(r,p,n)))},ClearContent:()=>{let r=p.node1.nextSibling;for(;r!==p.node2;)p.node1.parentNode.removeChild(r),r=p.node1.nextSibling},Unload:()=>()=>i.Unload()};return i=M(o,p,n),p}var C,E,j,z,H,k,R=class{constructor(e){w(this,j);w(this,H);w(this,C,[]);w(this,E,document.createElement("template"));let n="";for(let o=0;o<e.length-1;o++)n+=e[o],n+=N(this,j,z).call(this,n)?"{{fv"+o+"}}":"<!--{{fv"+o+"}}-->";n+=e[e.length-1],c(this,E).innerHTML=n,N(this,H,k).call(this,c(this,E).content,[])}MakeLive(e,n,o){let a=c(this,E).content.cloneNode(!0),i=c(this,C).map(p=>{let r=a;return p.path.forEach(l=>r=r.childNodes[l]),{ph:p,n:r}}).map(p=>p.ph.CreateOp(p.n,o,e)).filter(p=>p!==null);return n.parentNode.insertBefore(a,n),{Update:p=>{for(let r of i)r.Update(r.GetData(p))},Unload:()=>{for(let p of i)p.Unload()}}}};C=new WeakMap,E=new WeakMap,j=new WeakSet,z=function(e){return e.lastIndexOf("<")>e.lastIndexOf(">")},H=new WeakSet,k=function(e,n){let o,a,i,p,r,l;for(let s=0;s<e.childNodes.length;s++)if(o=e.childNodes[s],l=n.concat(s),o.nodeType===1){let m=o;m.tagName.toLowerCase()==="select"&&N(this,H,k).call(this,o,l);let f=[],d=[],A=!1;for(let L=0;L<m.attributes.length;L++){if(r=m.attributes[L],r.name==="class"){if(f.length>0)throw new u("Cannot combine 'class' and 'class:...' attributes on same element");A=!0}if(a=r.value,i=a.indexOf("{{fv"),i<0){if(r.name.startsWith("class:"))throw new u(r.name+" attribute must have ${boolean} value");(r.name.charAt(0)==="#"||r.name.charAt(0)===".")&&((r.name.charAt(0)==="#"?d:c(this,C)).push(te(l,r.name,a)),m.removeAttribute(r.name),L-=1);continue}let g=[];for(;i>=0;){if(i>0&&g.push(a.substr(0,i)),a=a.substr(i+4),i=a.indexOf("}}"),i<0)throw new u("Unexpected missing }}");p=parseInt(a.substr(0,i)),g.push(p),a=a.substr(i+2),i=a.indexOf("{{fv")}if(a.length>0&&g.push(a),g.length===1)if(r.name.startsWith("class:")){if(A)throw new u("Cannot combine 'class' and 'class:...' attributes on same element");f.push({class:r.name.substr(6),argidx:g[0]})}else(r.name.charAt(0)==="#"?d:c(this,C)).push(ne(l,r.name,g[0]));else{if(r.name.startsWith("class:"))throw new u(r.name+" attribute must have ${boolean} value");(r.name.charAt(0)==="#"?d:c(this,C)).push(re(l,r.name,g))}m.removeAttribute(r.name),L-=1}f.length>0&&c(this,C).push(oe(l,f)),c(this,C).push(...d),m.tagName.toLowerCase()!=="select"&&N(this,H,k).call(this,o,l)}else if(o.nodeType===8){let m=o;m.data.substr(0,4)==="{{fv"&&(p=parseInt(m.data.substr(4,m.data.length-6)),m.data="",e.insertBefore(document.createComment(""),o),c(this,C).push(ae(l,p)),s+=1)}};function te(t,e,n){return{path:t,CreateOp(o,a,i){let p=r=>n;return F(o,e,p,a,p(i)),null}}}function ne(t,e,n){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(o,a,i){let p=r=>r[n];return F(o,e,p,a,p(i))}}}function re(t,e,n){return e.startsWith("_")&&(e=e.substring(1)),{path:t,CreateOp(o,a,i){let p;return(e==="#bind"||e.substr(0,6)==="#bind|")&&n.length===2&&typeof n[1]=="string"&&n[1].charAt(0)==="."?p=r=>[r[n[0]],n[1].substr(1)]:p=r=>n.map(l=>typeof l=="string"?l:r[l].toString()).join(""),F(o,e,p,a,p(i))}}}function oe(t,e){return{path:t,CreateOp(n,o,a){let i=p=>{let r="",l;for(let s=0;s<e.length;s++){if(l=p[e[s].argidx],typeof l!="boolean")throw new u("class:"+e[s].class+" value must be boolean");l&&(r+=(r.length>0?" ":"")+e[s].class)}return r.length===0?!1:r};return F(n,"class",i,o,i(a))}}}function ae(t,e){return{path:t,CreateOp(n,o,a){return x(n,e,o,a[e])}}}var y,S=class{constructor(){h(this,"deps");h(this,"render2");w(this,y,void 0)}render(){if(c(this,y)&&c(this,y).length===this.deps.length){let e=!0;for(let n=0;n<c(this,y).length;n++)if(c(this,y)[n]!==this.deps[n]){e=!1;break}if(e)return this.deps=void 0,new V}return B(this,y,Object.assign({},this.deps)),this.deps=void 0,this.render2()}};y=new WeakMap;function D(t,e){if(!t||!Array.isArray(t))throw new u("memo deps argument must be array");if(!e||typeof e!="function")throw new u("memo render argument must be function");return[S,{deps:t,render2:e}]}var K=(t,e)=>b.set(t,e),Q=t=>new U(t),J=new Map;function P(t,...e){let n=J.get(t);return n||(n=new R(t),J.set(t,n)),new T(n,e)}function X(t,e){typeof t=="string"&&(t=document.querySelector(t));let n,o={autoRedraw:!0,redraw(){n.Update(e())},clear(){n.ClearContent()}},a=document.createDocumentFragment(),i=document.createComment("FrontView");a.appendChild(i);let p=document.createComment("/FrontView");return a.appendChild(p),n=x(i,-1,new v(o),e()),t.appendChild(a),o}globalThis.FV={html:P,app:X,raw:Q,directive:K,memo:D};globalThis.html=P;})();
